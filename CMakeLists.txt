CMAKE_MINIMUM_REQUIRED(VERSION 3.9)

PROJECT(vkh VERSION 0.1.0 DESCRIPTION "Vulkan helpers library")

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake")
SET(CMAKE_CXX_FLAGS "-W -Wall")
SET(CMAKE_EXE_LINKER_FLAGS "-lm")

IF(NOT CMAKE_BUILD_TYPE)
  SET(CMAKE_BUILD_TYPE Release)
ENDIF()
MESSAGE(STATUS "${CMAKE_BUILD_TYPE} build.")

if (CMAKE_BUILD_TYPE STREQUAL "Debug")
	ADD_DEFINITIONS (-DDEBUG)
ENDIF()

FIND_PACKAGE(Vulkan REQUIRED)
FIND_PACKAGE(GLFW3 REQUIRED)

INCLUDE(GNUInstallDirs)

FILE(GLOB sources src/*.c)

ADD_LIBRARY(objlib OBJECT ${sources})
TARGET_INCLUDE_DIRECTORIES(objlib PRIVATE
		${CMAKE_CURRENT_SOURCE_DIR}/include
		${CMAKE_CURRENT_SOURCE_DIR}/src
)
SET_PROPERTY(TARGET objlib PROPERTY POSITION_INDEPENDENT_CODE 1) #PIC option for shared lib

ADD_LIBRARY("${PROJECT_NAME}_shared" SHARED $<TARGET_OBJECTS:objlib>)
ADD_LIBRARY("${PROJECT_NAME}_static" STATIC $<TARGET_OBJECTS:objlib>)

CONFIGURE_FILE(vkh.pc.in vkh.pc @ONLY)
INSTALL(FILES ${CMAKE_BINARY_DIR}/vkh.pc DESTINATION ${CMAKE_INSTALL_DATAROOTDIR}/pkgconfig)

FUNCTION (setup_lib LibName)
	SET_TARGET_PROPERTIES(${LibName} PROPERTIES
			VERSION ${PROJECT_VERSION}
			SOVERSION 1
			PUBLIC_HEADER include/vkh.h
	)
	TARGET_LINK_LIBRARIES(${LibName}
		${Vulkan_LIBRARY}
		${GLFW3_LIBRARY}
	)
	INSTALL(TARGETS ${LibName}
		LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
		ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
		PUBLIC_HEADER DESTINATION ${CMAKE_INSTALL_INCLUDEDIR})
ENDFUNCTION ()

setup_lib ("${PROJECT_NAME}_static")
setup_lib ("${PROJECT_NAME}_shared")


#get_cmake_property(_variableNames VARIABLES)
#foreach (_variableName ${_variableNames})
#message(STATUS "${_variableName}=${${_variableName}}")
#endforeach()
